<!DOCTYPE html>  <html> <head>   <title>Sequence.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="Wiggy.html">                 Wiggy.coffee               </a>                                           <a class="source" href="Dictionary.html">                 Dictionary.coffee               </a>                                           <a class="source" href="Sequence.html">                 Sequence.coffee               </a>                                           <a class="source" href="Observable.html">                 Observable.coffee               </a>                                           <a class="source" href="Properties.html">                 Properties.coffee               </a>                                           <a class="source" href="Button.html">                 Button.coffee               </a>                                           <a class="source" href="ButtonGroup.html">                 ButtonGroup.coffee               </a>                                           <a class="source" href="Checkbox.html">                 Checkbox.coffee               </a>                                           <a class="source" href="DynamicContainer.html">                 DynamicContainer.coffee               </a>                                           <a class="source" href="Element.html">                 Element.coffee               </a>                                           <a class="source" href="Field.html">                 Field.coffee               </a>                                           <a class="source" href="LayoutContainer.html">                 LayoutContainer.coffee               </a>                                           <a class="source" href="Panel.html">                 Panel.coffee               </a>                                           <a class="source" href="Radiobutton.html">                 Radiobutton.coffee               </a>                                           <a class="source" href="Searchfield.html">                 Searchfield.coffee               </a>                                           <a class="source" href="TabPanel.html">                 TabPanel.coffee               </a>                                           <a class="source" href="Textarea.html">                 Textarea.coffee               </a>                                           <a class="source" href="Textfield.html">                 Textfield.coffee               </a>                                           <a class="source" href="Titlebar.html">                 Titlebar.coffee               </a>                                           <a class="source" href="Widget.html">                 Widget.coffee               </a>                                           <a class="source" href="Window.html">                 Window.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               Sequence.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h3>An evented array.</h3>

<p><em>Wraps a javascript array with extra functionality for handling events and other conveniance
functions.</em></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Wiggy</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">Sequence</span>
  <span class="nx">Wiggy</span><span class="p">.</span><span class="nx">mixin</span><span class="p">.</span><span class="nx">Observable</span> <span class="err">@</span>
  <span class="nx">Wiggy</span><span class="p">.</span><span class="nx">mixin</span><span class="p">.</span><span class="nx">Properties</span> <span class="err">@</span>

  <span class="nv">constructor: </span><span class="nf">(items) -&gt;</span>
    <span class="vi">@items = </span><span class="nx">items</span> <span class="o">or</span> <span class="p">[]</span>
    <span class="nx">@property</span> <span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="nv">get: </span><span class="o">-&gt;</span> <span class="nx">@items</span><span class="p">.</span><span class="nx">length</span>
    <span class="nx">@property</span> <span class="s1">&#39;isEmpty&#39;</span><span class="p">,</span> <span class="nv">get: </span><span class="o">-&gt;</span> <span class="nx">@length</span> <span class="o">is</span> <span class="mi">0</span>
    <span class="nx">@property</span> <span class="s1">&#39;unique&#39;</span><span class="p">,</span> <span class="nv">get: </span><span class="o">-&gt;</span>
      <span class="nv">result = </span><span class="k">new</span> <span class="nx">Wiggy</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">Sequence</span><span class="p">()</span>
      <span class="nv">values = </span><span class="p">{}</span>

      <span class="k">for</span> <span class="nx">val</span> <span class="k">in</span> <span class="nx">@items</span>
        <span class="nv">type = </span><span class="k">typeof</span> <span class="nx">val</span>
        <span class="k">if</span> <span class="nx">type</span> <span class="o">is</span> <span class="s2">&quot;string&quot;</span> <span class="o">or</span> <span class="nx">type</span> <span class="o">is</span> <span class="s2">&quot;number&quot;</span> <span class="o">or</span> <span class="nx">type</span> <span class="o">is</span> <span class="s2">&quot;boolean&quot;</span> <span class="o">or</span> <span class="nx">type</span> <span class="o">is</span> <span class="s2">&quot;undefined&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Since every value gets turned into a string when being set as a property
name, we must specify its initial type. This avoids the string value
"false" from being considered the same as the boolean value false</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">values</span><span class="p">[</span><span class="nx">type</span><span class="o">+</span><span class="nx">val</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span>

        <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>In the event of reference types, the only way to check if we already
have that reference is to loop through all the ones that were found so
far. Since value types are going to their own temporary object, we can
use 'result' exclusively for refs right now.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">result</span><span class="p">.</span><span class="nx">add</span> <span class="nx">val</span> <span class="nx">unless</span> <span class="nx">val</span> <span class="k">in</span> <span class="nx">result</span><span class="p">.</span><span class="nx">items</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Now that we've gone through all items, we add the value types to the
result sequence and return it.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">result</span><span class="p">.</span><span class="nx">add</span> <span class="p">(</span><span class="nx">val</span> <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">val</span> <span class="k">of</span> <span class="nx">values</span><span class="p">)</span>

    <span class="nx">@on</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span>    <span class="nx">@onAdd</span>
    <span class="nx">@on</span> <span class="s1">&#39;set&#39;</span><span class="p">,</span>    <span class="nx">@onSet</span>
    <span class="nx">@on</span> <span class="s1">&#39;insert&#39;</span><span class="p">,</span> <span class="nx">@onInsert</span>
    <span class="nx">@on</span> <span class="s1">&#39;remove&#39;</span><span class="p">,</span> <span class="nx">@onRemove</span>
    <span class="nx">@on</span> <span class="s1">&#39;clear&#39;</span><span class="p">,</span>  <span class="nx">@onClear</span>

  <span class="nv">has: </span><span class="nf">(val) -&gt;</span> <span class="nx">val</span> <span class="k">in</span> <span class="nx">@items</span>

  <span class="nv">get: </span><span class="nf">(idx) -&gt;</span> <span class="nx">@items</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span>

  <span class="nv">onSet: </span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nx">@items</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span>

  <span class="nv">onAdd: </span><span class="p">(</span><span class="nx">items</span><span class="p">...)</span> <span class="o">=&gt;</span>
    <span class="k">for</span> <span class="nx">item</span> <span class="k">in</span> <span class="nx">items</span>
      <span class="nx">@items</span><span class="p">.</span><span class="nx">push</span> <span class="nx">item</span>

  <span class="nv">onInsert: </span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nx">@items</span><span class="p">.</span><span class="nx">splice</span> <span class="nx">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">val</span>

  <span class="nv">onRemove: </span><span class="p">(</span><span class="nx">idxs</span><span class="p">...)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>sort indexes by descending order to ensure we don't offset items
located before our next deletion index</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">idxs = </span><span class="nx">idxs</span><span class="p">.</span><span class="nx">sort</span> <span class="nf">(a,b) -&gt;</span> <span class="nx">b</span> <span class="o">-</span> <span class="nx">a</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">idxs</span>
      <span class="nx">@items</span><span class="p">.</span><span class="nx">splice</span> <span class="nx">i</span><span class="p">,</span> <span class="mi">1</span>

  <span class="nv">onClear: </span><span class="o">=&gt;</span> <span class="vi">@items = </span><span class="p">[]</span>

  <span class="nv">sort: </span><span class="nf">(func) -&gt;</span> <span class="nx">@items</span><span class="p">.</span><span class="nx">sort</span> <span class="nx">func</span>

  <span class="nv">each: </span><span class="nf">(func) -&gt;</span> <span class="p">(</span><span class="nx">func</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">idx</span> <span class="k">for</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">idx</span> <span class="k">in</span> <span class="nx">@items</span><span class="p">)</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 